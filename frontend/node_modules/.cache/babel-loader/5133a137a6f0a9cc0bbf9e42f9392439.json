{"ast":null,"code":"var _jsxFileName = \"D:\\\\Website\\\\Note\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n    _s = $RefreshSig$();\n\nimport React, { createContext, useEffect, useState } from \"react\";\nimport jwt_decode from \"jwt-decode\";\nimport { useNavigate } from \"react-router-dom\";\nimport API from \"../ultis/API\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport default AuthContext;\nexport const ContextProvider = _ref => {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  let localAuthToken = localStorage.getItem(\"authToken\") ? JSON.parse(localStorage.getItem(\"authToken\")) : null;\n  let localAuthUser = localStorage.getItem(\"authToken\") ? jwt_decode(localStorage.getItem(\"authToken\")) : null;\n  const [authToken, setAuthToken] = useState(() => localAuthToken);\n  const [user, setUser] = useState(() => localAuthUser);\n  const [loading, setLoading] = useState(true);\n  let navigate = useNavigate();\n\n  const loginUser = async e => {\n    e.preventDefault();\n\n    try {\n      let response = await API.post(\"token/\", {\n        username: e.target.username.value,\n        password: e.target.password.value\n      });\n      setAuthToken(response.data);\n      setUser(jwt_decode(response.data.access));\n      localStorage.setItem(\"authToken\", JSON.stringify(response.data));\n      navigate(\"/\");\n    } catch (err) {\n      console.log(err);\n      logoutUser();\n    }\n  };\n\n  const logoutUser = () => {\n    setUser(null);\n    setAuthToken(null);\n    localStorage.removeItem(\"authToken\");\n    navigate(\"/login\");\n  };\n\n  const updateToken = async () => {\n    try {\n      let response = await API.post(\"token/refresh/\", {\n        refresh: authToken.refresh\n      });\n      localStorage.setItem(\"authToken\", JSON.stringify(response.data));\n      setAuthToken(response.data);\n      setUser(jwt_decode(response.data.access));\n    } catch (error) {}\n\n    if (loading) {\n      setLoading(false);\n    }\n  };\n\n  const registerUser = async e => {\n    e.preventDefault();\n\n    try {\n      let resp = await API.post(`register/`, {\n        username: e.target.username.value,\n        password\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const contextData = {\n    user: user,\n    authToken: authToken,\n    loginUser: loginUser,\n    logoutUser: logoutUser\n  };\n  useEffect(() => {\n    if (loading) {\n      updateToken();\n    }\n\n    let interval = setInterval(() => {\n      if (authToken) {\n        updateToken();\n      }\n    }, 1000 * 60 * 4);\n    return () => clearInterval(interval);\n  }, [authToken, loading]); // eslint-disable-next-line\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: contextData,\n    children: loading ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 18\n    }, this) : children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 93,\n    columnNumber: 5\n  }, this);\n};\n\n_s(ContextProvider, \"BDHGH/V3MiIqrG4KMQ04pzd2eCc=\", false, function () {\n  return [useNavigate];\n});\n\n_c = ContextProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"ContextProvider\");","map":{"version":3,"names":["React","createContext","useEffect","useState","jwt_decode","useNavigate","API","AuthContext","ContextProvider","children","localAuthToken","localStorage","getItem","JSON","parse","localAuthUser","authToken","setAuthToken","user","setUser","loading","setLoading","navigate","loginUser","e","preventDefault","response","post","username","target","value","password","data","access","setItem","stringify","err","console","log","logoutUser","removeItem","updateToken","refresh","error","registerUser","resp","contextData","interval","setInterval","clearInterval"],"sources":["D:/Website/Note/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useEffect, useState } from \"react\";\r\nimport jwt_decode from \"jwt-decode\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport API from \"../ultis/API\";\r\n\r\nconst AuthContext = createContext();\r\nexport default AuthContext;\r\n\r\nexport const ContextProvider = ({ children }) => {\r\n  let localAuthToken = localStorage.getItem(\"authToken\")\r\n    ? JSON.parse(localStorage.getItem(\"authToken\"))\r\n    : null;\r\n  let localAuthUser = localStorage.getItem(\"authToken\")\r\n    ? jwt_decode(localStorage.getItem(\"authToken\"))\r\n    : null;\r\n  const [authToken, setAuthToken] = useState(() => localAuthToken);\r\n  const [user, setUser] = useState(() => localAuthUser);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  let navigate = useNavigate();\r\n  const loginUser = async (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      let response = await API.post(\"token/\", {\r\n        username: e.target.username.value,\r\n        password: e.target.password.value,\r\n      });\r\n\r\n      setAuthToken(response.data);\r\n      setUser(jwt_decode(response.data.access));\r\n      localStorage.setItem(\"authToken\", JSON.stringify(response.data));\r\n      navigate(\"/\");\r\n    } catch (err) {\r\n      console.log(err);\r\n      logoutUser();\r\n    }\r\n  };\r\n\r\n  const logoutUser = () => {\r\n    setUser(null);\r\n    setAuthToken(null);\r\n    localStorage.removeItem(\"authToken\");\r\n    navigate(\"/login\");\r\n  };\r\n\r\n  const updateToken = async () => {\r\n    try {\r\n      let response = await API.post(\"token/refresh/\", {\r\n        refresh: authToken.refresh,\r\n      });\r\n      localStorage.setItem(\"authToken\", JSON.stringify(response.data));\r\n      setAuthToken(response.data);\r\n      setUser(jwt_decode(response.data.access));\r\n    } catch (error) {}\r\n\r\n    if (loading) {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const registerUser = async (e)=>{\r\n    e.preventDefault()\r\n    try{\r\n      let resp = await API.post(`register/`,{\r\n        username:e.target.username.value,\r\n        password\r\n      })\r\n    }catch(error){\r\n      console.log(error)\r\n    }\r\n  }\r\n  const contextData = {\r\n    user: user,\r\n    authToken: authToken,\r\n    loginUser: loginUser,\r\n    logoutUser: logoutUser,\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (loading) {\r\n      updateToken();\r\n    }\r\n\r\n    let interval = setInterval(() => {\r\n      if (authToken) {\r\n        updateToken();\r\n      }\r\n    }, 1000 * 60 * 4);\r\n    return () => clearInterval(interval);\r\n  }, [authToken, loading]);// eslint-disable-next-line\r\n\r\n  return (\r\n    <AuthContext.Provider value={contextData}>\r\n      {loading ? <p>loading...</p> : children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}