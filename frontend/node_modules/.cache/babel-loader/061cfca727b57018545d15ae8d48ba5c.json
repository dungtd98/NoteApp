{"ast":null,"code":"import _regeneratorRuntime from\"D:/Website/Note/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/Website/Note/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/Website/Note/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{createContext,useEffect,useState}from\"react\";import jwt_decode from\"jwt-decode\";import{useNavigate}from\"react-router-dom\";import API from\"../ultis/API\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/createContext();export default AuthContext;export var ContextProvider=function ContextProvider(_ref){var children=_ref.children;var localAuthToken=localStorage.getItem(\"authToken\")?JSON.parse(localStorage.getItem(\"authToken\")):null;var localAuthUser=localStorage.getItem(\"authToken\")?jwt_decode(localStorage.getItem(\"authToken\")):null;var _useState=useState(function(){return localAuthToken;}),_useState2=_slicedToArray(_useState,2),authToken=_useState2[0],setAuthToken=_useState2[1];var _useState3=useState(function(){return localAuthUser;}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var navigate=useNavigate();var loginUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;_context.next=4;return API.post(\"token/\",{username:e.target.username.value,password:e.target.password.value});case 4:response=_context.sent;setAuthToken(response.data);setUser(jwt_decode(response.data.access));localStorage.setItem(\"authToken\",JSON.stringify(response.data));navigate(\"/\");_context.next=15;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](1);console.log(_context.t0);logoutUser();case 15:case\"end\":return _context.stop();}}},_callee,null,[[1,11]]);}));return function loginUser(_x){return _ref2.apply(this,arguments);};}();var logoutUser=function logoutUser(){setUser(null);setAuthToken(null);localStorage.removeItem(\"authToken\");navigate(\"/login\");};var updateToken=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var response;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return API.post(\"token/refresh/\",{refresh:authToken.refresh});case 3:response=_context2.sent;localStorage.setItem(\"authToken\",JSON.stringify(response.data));setAuthToken(response.data);setUser(jwt_decode(response.data.access));_context2.next=11;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);case 11:if(loading){setLoading(false);}case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9]]);}));return function updateToken(){return _ref3.apply(this,arguments);};}();var registerUser=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(e){var resp;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();_context3.prev=1;_context3.next=4;return API.post(\"register/\",{username:e.target.username.value,email:e.target.email.value,password:e.target.password.value});case 4:resp=_context3.sent;console.log(resp);navigate('/login');_context3.next=13;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);console.log(_context3.t0);alert('Try again!!');case 13:case\"end\":return _context3.stop();}}},_callee3,null,[[1,9]]);}));return function registerUser(_x2){return _ref4.apply(this,arguments);};}();var contextData={user:user,authToken:authToken,loginUser:loginUser,logoutUser:logoutUser,registerUser:registerUser};// eslint-disable-next-line\nuseEffect(function(){if(loading){updateToken();}var interval=setInterval(function(){if(authToken){updateToken();}},1000*60*4);return function(){return clearInterval(interval);};},[authToken,loading]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextData,children:loading?/*#__PURE__*/_jsx(\"p\",{children:\"loading...\"}):children});};","map":{"version":3,"names":["React","createContext","useEffect","useState","jwt_decode","useNavigate","API","AuthContext","ContextProvider","children","localAuthToken","localStorage","getItem","JSON","parse","localAuthUser","authToken","setAuthToken","user","setUser","loading","setLoading","navigate","loginUser","e","preventDefault","post","username","target","value","password","response","data","access","setItem","stringify","console","log","logoutUser","removeItem","updateToken","refresh","registerUser","email","resp","alert","contextData","interval","setInterval","clearInterval"],"sources":["D:/Website/Note/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useEffect, useState } from \"react\";\r\nimport jwt_decode from \"jwt-decode\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport API from \"../ultis/API\";\r\n\r\nconst AuthContext = createContext();\r\nexport default AuthContext;\r\n\r\nexport const ContextProvider = ({ children }) => {\r\n  let localAuthToken = localStorage.getItem(\"authToken\")\r\n    ? JSON.parse(localStorage.getItem(\"authToken\"))\r\n    : null;\r\n  let localAuthUser = localStorage.getItem(\"authToken\")\r\n    ? jwt_decode(localStorage.getItem(\"authToken\"))\r\n    : null;\r\n  const [authToken, setAuthToken] = useState(() => localAuthToken);\r\n  const [user, setUser] = useState(() => localAuthUser);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  let navigate = useNavigate();\r\n  const loginUser = async (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      let response = await API.post(\"token/\", {\r\n        username: e.target.username.value,\r\n        password: e.target.password.value,\r\n      });\r\n\r\n      setAuthToken(response.data);\r\n      setUser(jwt_decode(response.data.access));\r\n      localStorage.setItem(\"authToken\", JSON.stringify(response.data));\r\n      navigate(\"/\");\r\n    } catch (err) {\r\n      console.log(err);\r\n      logoutUser();\r\n    }\r\n  };\r\n\r\n  const logoutUser = () => {\r\n    setUser(null);\r\n    setAuthToken(null);\r\n    localStorage.removeItem(\"authToken\");\r\n    navigate(\"/login\");\r\n  };\r\n\r\n  const updateToken = async () => {\r\n    try {\r\n      let response = await API.post(\"token/refresh/\", {\r\n        refresh: authToken.refresh,\r\n      });\r\n      localStorage.setItem(\"authToken\", JSON.stringify(response.data));\r\n      setAuthToken(response.data);\r\n      setUser(jwt_decode(response.data.access));\r\n    } catch (error) {}\r\n\r\n    if (loading) {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const registerUser = async (e)=>{\r\n    e.preventDefault()\r\n    try{\r\n      let resp = await API.post(`register/`,{\r\n        username:e.target.username.value,\r\n        email:e.target.email.value,\r\n        password:e.target.password.value\r\n      })\r\n      console.log(resp)\r\n      navigate('/login')\r\n    }catch(error){\r\n      console.log(error)\r\n      alert('Try again!!')\r\n    }\r\n  }\r\n  const contextData = {\r\n    user: user,\r\n    authToken: authToken,\r\n    loginUser: loginUser,\r\n    logoutUser: logoutUser,\r\n    registerUser:registerUser,\r\n  };\r\n  // eslint-disable-next-line\r\n  useEffect(() => {\r\n    if (loading) {\r\n      updateToken();\r\n    }\r\n\r\n    let interval = setInterval(() => {\r\n      if (authToken) {\r\n        updateToken();\r\n      }\r\n    }, 1000 * 60 * 4);\r\n    return () => clearInterval(interval);\r\n  }, [authToken, loading]);\r\n\r\n  return (\r\n    <AuthContext.Provider value={contextData}>\r\n      {loading ? <p>loading...</p> : children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"0VAAA,MAAOA,MAAP,EAAgBC,aAAhB,CAA+BC,SAA/B,CAA0CC,QAA1C,KAA0D,OAA1D,CACA,MAAOC,WAAP,KAAuB,YAAvB,CACA,OAASC,WAAT,KAA4B,kBAA5B,CACA,MAAOC,IAAP,KAAgB,cAAhB,C,2CAEA,GAAMC,YAAW,cAAGN,aAAa,EAAjC,CACA,cAAeM,YAAf,CAEA,MAAO,IAAMC,gBAAe,CAAG,QAAlBA,gBAAkB,MAAkB,IAAfC,SAAe,MAAfA,QAAe,CAC/C,GAAIC,eAAc,CAAGC,YAAY,CAACC,OAAb,CAAqB,WAArB,EACjBC,IAAI,CAACC,KAAL,CAAWH,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAX,CADiB,CAEjB,IAFJ,CAGA,GAAIG,cAAa,CAAGJ,YAAY,CAACC,OAAb,CAAqB,WAArB,EAChBR,UAAU,CAACO,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAD,CADM,CAEhB,IAFJ,CAGA,cAAkCT,QAAQ,CAAC,iBAAMO,eAAN,EAAD,CAA1C,wCAAOM,SAAP,eAAkBC,YAAlB,eACA,eAAwBd,QAAQ,CAAC,iBAAMY,cAAN,EAAD,CAAhC,yCAAOG,IAAP,eAAaC,OAAb,eACA,eAA8BhB,QAAQ,CAAC,IAAD,CAAtC,yCAAOiB,OAAP,eAAgBC,UAAhB,eAEA,GAAIC,SAAQ,CAAGjB,WAAW,EAA1B,CACA,GAAMkB,UAAS,6FAAG,iBAAOC,CAAP,iIAChBA,CAAC,CAACC,cAAF,GADgB,sCAGOnB,IAAG,CAACoB,IAAJ,CAAS,QAAT,CAAmB,CACtCC,QAAQ,CAAEH,CAAC,CAACI,MAAF,CAASD,QAAT,CAAkBE,KADU,CAEtCC,QAAQ,CAAEN,CAAC,CAACI,MAAF,CAASE,QAAT,CAAkBD,KAFU,CAAnB,CAHP,QAGVE,QAHU,eAQdd,YAAY,CAACc,QAAQ,CAACC,IAAV,CAAZ,CACAb,OAAO,CAACf,UAAU,CAAC2B,QAAQ,CAACC,IAAT,CAAcC,MAAf,CAAX,CAAP,CACAtB,YAAY,CAACuB,OAAb,CAAqB,WAArB,CAAkCrB,IAAI,CAACsB,SAAL,CAAeJ,QAAQ,CAACC,IAAxB,CAAlC,EACAV,QAAQ,CAAC,GAAD,CAAR,CAXc,iFAadc,OAAO,CAACC,GAAR,cACAC,UAAU,GAdI,qEAAH,kBAATf,UAAS,6CAAf,CAkBA,GAAMe,WAAU,CAAG,QAAbA,WAAa,EAAM,CACvBnB,OAAO,CAAC,IAAD,CAAP,CACAF,YAAY,CAAC,IAAD,CAAZ,CACAN,YAAY,CAAC4B,UAAb,CAAwB,WAAxB,EACAjB,QAAQ,CAAC,QAAD,CAAR,CACD,CALD,CAOA,GAAMkB,YAAW,6FAAG,+LAEKlC,IAAG,CAACoB,IAAJ,CAAS,gBAAT,CAA2B,CAC9Ce,OAAO,CAAEzB,SAAS,CAACyB,OAD2B,CAA3B,CAFL,QAEZV,QAFY,gBAKhBpB,YAAY,CAACuB,OAAb,CAAqB,WAArB,CAAkCrB,IAAI,CAACsB,SAAL,CAAeJ,QAAQ,CAACC,IAAxB,CAAlC,EACAf,YAAY,CAACc,QAAQ,CAACC,IAAV,CAAZ,CACAb,OAAO,CAACf,UAAU,CAAC2B,QAAQ,CAACC,IAAT,CAAcC,MAAf,CAAX,CAAP,CAPgB,2FAUlB,GAAIb,OAAJ,CAAa,CACXC,UAAU,CAAC,KAAD,CAAV,CACD,CAZiB,sEAAH,kBAAXmB,YAAW,2CAAjB,CAeA,GAAME,aAAY,6FAAG,kBAAOlB,CAAP,iIACnBA,CAAC,CAACC,cAAF,GADmB,wCAGAnB,IAAG,CAACoB,IAAJ,aAAqB,CACpCC,QAAQ,CAACH,CAAC,CAACI,MAAF,CAASD,QAAT,CAAkBE,KADS,CAEpCc,KAAK,CAACnB,CAAC,CAACI,MAAF,CAASe,KAAT,CAAed,KAFe,CAGpCC,QAAQ,CAACN,CAAC,CAACI,MAAF,CAASE,QAAT,CAAkBD,KAHS,CAArB,CAHA,QAGbe,IAHa,gBAQjBR,OAAO,CAACC,GAAR,CAAYO,IAAZ,EACAtB,QAAQ,CAAC,QAAD,CAAR,CATiB,mFAWjBc,OAAO,CAACC,GAAR,eACAQ,KAAK,CAAC,aAAD,CAAL,CAZiB,sEAAH,kBAAZH,aAAY,8CAAlB,CAeA,GAAMI,YAAW,CAAG,CAClB5B,IAAI,CAAEA,IADY,CAElBF,SAAS,CAAEA,SAFO,CAGlBO,SAAS,CAAEA,SAHO,CAIlBe,UAAU,CAAEA,UAJM,CAKlBI,YAAY,CAACA,YALK,CAApB,CAOA;AACAxC,SAAS,CAAC,UAAM,CACd,GAAIkB,OAAJ,CAAa,CACXoB,WAAW,GACZ,CAED,GAAIO,SAAQ,CAAGC,WAAW,CAAC,UAAM,CAC/B,GAAIhC,SAAJ,CAAe,CACbwB,WAAW,GACZ,CACF,CAJyB,CAIvB,KAAO,EAAP,CAAY,CAJW,CAA1B,CAKA,MAAO,kBAAMS,cAAa,CAACF,QAAD,CAAnB,EAAP,CACD,CAXQ,CAWN,CAAC/B,SAAD,CAAYI,OAAZ,CAXM,CAAT,CAaA,mBACE,KAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAE0B,WAA7B,UACG1B,OAAO,cAAG,iCAAH,CAAuBX,QADjC,EADF,CAKD,CA7FM"},"metadata":{},"sourceType":"module"}