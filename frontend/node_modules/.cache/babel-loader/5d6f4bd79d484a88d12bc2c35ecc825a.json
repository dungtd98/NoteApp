{"ast":null,"code":"var _jsxFileName = \"D:\\\\Website\\\\Note\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n    _s = $RefreshSig$();\n\nimport React, { createContext, useEffect, useState } from \"react\";\nimport jwt_decode from \"jwt-decode\";\nimport { useNavigate } from \"react-router-dom\";\nimport API from '../ultis/API';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport default AuthContext;\nexport const ContextProvider = _ref => {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  let localAuthToken = localStorage.getItem(\"authToken\") ? JSON.parse(localStorage.getItem(\"authToken\")) : null;\n  let localAuthUser = localStorage.getItem(\"authToken\") ? jwt_decode(localStorage.getItem(\"authToken\")) : null;\n  const [authToken, setAuthToken] = useState(() => localAuthToken);\n  const [user, setUser] = useState(() => localAuthUser);\n  const [loading, setLoading] = useState(true);\n  let navigate = useNavigate();\n\n  const loginUser = async e => {\n    e.preventDefault();\n\n    try {\n      let response = await AxiosInstance.post('token/', {\n        username: e.target.username.value,\n        password: e.target.password.value\n      });\n      setAuthToken(response.data);\n      setUser(jwt_decode(response.data.access));\n      localStorage.setItem('authToken', JSON.stringify(response.data));\n      navigate('/');\n    } catch (err) {\n      console.log(err);\n      logoutUser();\n    }\n  };\n\n  const logoutUser = () => {\n    setUser(null);\n    setAuthToken(null);\n    localStorage.removeItem(\"authToken\");\n    navigate(\"/login\");\n  };\n\n  const updateToken = async () => {\n    try {\n      let response = await API.post('refresh/', {\n        refresh: authToken === null || authToken === void 0 ? void 0 : authToken.refresh\n      });\n      localStorage.setItem('authToken', response.data);\n      setAuthToken(response.data);\n      setUser(jwt_decode(response.data.access));\n    } catch (error) {}\n\n    if (loading) {\n      setLoading(false);\n    }\n  };\n\n  const contextData = {\n    user: user,\n    authToken: authToken,\n    loginUser: loginUser,\n    logoutUser: logoutUser\n  };\n  useEffect(() => {\n    if (loading) {\n      updateToken();\n    }\n\n    let interval = setInterval(() => {\n      if (authToken) {\n        updateToken();\n      }\n    }, 1000 * 60 * 4);\n    return () => clearInterval(interval);\n  }, [authToken, loading]);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: contextData,\n    children: loading ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 17\n    }, this) : children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 84,\n    columnNumber: 5\n  }, this);\n};\n\n_s(ContextProvider, \"BDHGH/V3MiIqrG4KMQ04pzd2eCc=\", false, function () {\n  return [useNavigate];\n});\n\n_c = ContextProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"ContextProvider\");","map":{"version":3,"names":["React","createContext","useEffect","useState","jwt_decode","useNavigate","API","AuthContext","ContextProvider","children","localAuthToken","localStorage","getItem","JSON","parse","localAuthUser","authToken","setAuthToken","user","setUser","loading","setLoading","navigate","loginUser","e","preventDefault","response","AxiosInstance","post","username","target","value","password","data","access","setItem","stringify","err","console","log","logoutUser","removeItem","updateToken","refresh","error","contextData","interval","setInterval","clearInterval"],"sources":["D:/Website/Note/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useEffect, useState } from \"react\";\r\nimport jwt_decode from \"jwt-decode\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport API from '../ultis/API'\r\n\r\n\r\nconst AuthContext = createContext();\r\nexport default AuthContext;\r\n\r\nexport const ContextProvider = ({ children }) => {\r\n  let localAuthToken = localStorage.getItem(\"authToken\")\r\n    ? JSON.parse(localStorage.getItem(\"authToken\"))\r\n    : null;\r\n  let localAuthUser = localStorage.getItem(\"authToken\")\r\n    ? jwt_decode(localStorage.getItem(\"authToken\"))\r\n    : null;\r\n  const [authToken, setAuthToken] = useState(() => localAuthToken);\r\n  const [user, setUser] = useState(() => localAuthUser);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  let navigate = useNavigate();\r\n  const loginUser = async (e) => {\r\n    \r\n    e.preventDefault()\r\n        try{\r\n            let response = await AxiosInstance.post('token/',{\r\n                username: e.target.username.value,\r\n                password: e.target.password.value\r\n            });\r\n            \r\n            setAuthToken(response.data)\r\n            setUser(jwt_decode(response.data.access))\r\n            localStorage.setItem('authToken',JSON.stringify(response.data))\r\n            navigate('/')\r\n        } catch(err){\r\n            console.log(err)\r\n            logoutUser()\r\n        }\r\n  };\r\n\r\n  const logoutUser = () => {\r\n    setUser(null);\r\n    setAuthToken(null);\r\n    localStorage.removeItem(\"authToken\");\r\n    navigate(\"/login\");\r\n  };\r\n\r\n  const updateToken= async ()=>{\r\n      try{\r\n        let response = await API.post('refresh/',{\r\n            refresh:authToken?.refresh\r\n        })\r\n        localStorage.setItem('authToken', response.data)\r\n        setAuthToken(response.data)\r\n        setUser(jwt_decode(response.data.access))\r\n      }catch(error){}\r\n\r\n      if(loading){\r\n          setLoading(false)\r\n      }\r\n  }\r\n\r\n  const contextData = {\r\n    user: user,\r\n    authToken: authToken,\r\n    loginUser: loginUser,\r\n    logoutUser: logoutUser,\r\n  };\r\n\r\n  useEffect(()=>{\r\n    if(loading){\r\n        updateToken()\r\n    }\r\n\r\n    let interval = setInterval(()=>{\r\n        if(authToken){\r\n            updateToken()\r\n        }\r\n    }, 1000*60*4)\r\n    return ()=>clearInterval(interval)\r\n  },[authToken, loading])\r\n\r\n  return (\r\n    <AuthContext.Provider value={contextData}>{\r\n        loading?<p>loading...</p>:children\r\n    }</AuthContext.Provider>\r\n  );\r\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}